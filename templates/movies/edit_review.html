{% extends 'base.html' %}

{% block content %}
<div class="max-w-2xl mx-auto bg-gray-800 p-8 rounded-xl shadow-2xl border border-gray-700">
    <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold text-yellow-500 flex items-center">
            <span class="mr-2">✏️</span> แก้ไขรีวิว: {{ movie.title }}
        </h2>
        <a href="{% url 'movie_detail' movie.tmdb_id %}" class="text-gray-400 hover:text-white text-sm">
            ยกเลิก
        </a>
    </div>
    
    <form method="post" class="space-y-6">
        {% csrf_token %}
        
        <!-- Primary Mood -->
        <div>
            <label class="block text-lg font-semibold mb-2 text-gray-300">อารมณ์หลัก (เปลี่ยนได้)</label>
            {{ form.primary_mood }}
        </div>

        <!-- Intensity (Slider) -->
        <div>
             <label class="block text-lg font-semibold mb-2 text-gray-300 flex justify-between">
                <span>ความเข้มข้นของอารมณ์</span>
                <span id="intensity-value" class="text-yellow-500 font-bold">{{ review.mood_intensity }}</span>
            </label>
            <div class="flex items-center gap-4">
                <span class="text-sm text-gray-400">น้อย (1)</span>
                {{ form.mood_intensity }}
                <span class="text-sm text-gray-400">มาก (5)</span>
            </div>
        </div>

        <!-- Rating -->
        <div>
            <label class="block text-lg font-semibold mb-2 text-gray-300">คะแนนความชอบ (เต็ม 10)</label>
            {{ form.rating }}
        </div>

        <!-- Review Text -->
        <div>
            <label class="block text-lg font-semibold mb-2 text-gray-300">ข้อความรีวิว</label>
            {{ form.review_text }}
        </div>

        <div class="flex gap-4 pt-4">
            <button type="submit" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-[1.02]">
                บันทึกการแก้ไข
            </button>
            
            <!-- ปุ่มลบ (เผื่ออยากลบในหน้านี้เลย) -->
            <a href="{% url 'delete_review' review.id %}" 
               onclick="return confirm('ยืนยันที่จะลบรีวิวนี้? ไม่สามารถกู้คืนได้นะ')"
               class="px-6 py-3 rounded-lg border border-red-500/50 text-red-400 hover:bg-red-900/20 transition flex items-center justify-center">
                ลบรีวิว
            </a>
        </div>
    </form>
</div>

<script>
    const slider = document.querySelector('input[type="range"]');
    const output = document.getElementById('intensity-value');
    if (slider && output) {
        // ตั้งค่าเริ่มต้นให้ตรงกับค่าใน DB
        output.textContent = slider.value;
        slider.oninput = function() {
            output.textContent = this.value;
        }
    }
</script>
{% endblock %}