{% extends 'base.html' %}

{% block content %}
<div class="max-w-6xl mx-auto">
    <div class="text-center mb-12">
        <h1 class="text-3xl md:text-4xl font-bold mb-4">
            หนังสำหรับอารมณ์ <span class="text-yellow-500">"{{ mood.name }}"</span>
        </h1>
        <p class="text-lg md:text-xl text-gray-400">
            คัดมาเน้นๆ จากความรู้สึกจริง (Weighted Score)
        </p>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6">
        {% for movie in movies %}
        <a href="{% url 'movie_detail' movie.tmdb_id %}" class="block bg-gray-800 rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition duration-300 transform hover:-translate-y-2 relative group h-full flex flex-col">
            
            <div class="relative flex-shrink-0">
                {% if movie.poster_path %}
                <img src="https://image.tmdb.org/t/p/w500{{ movie.poster_path }}" alt="{{ movie.title }}" class="w-full h-64 md:h-72 object-cover">
                {% else %}
                <div class="w-full h-64 md:h-72 bg-gray-700 flex items-center justify-center text-gray-500">No Poster</div>
                {% endif %}

                <!-- Overlay Rank (ถ้าอยากใส่ลำดับที่) -->
                <div class="absolute top-0 left-0 bg-yellow-500 text-gray-900 font-bold px-3 py-1 rounded-br-lg shadow-md z-10">
                    #{{ forloop.counter }}
                </div>
            </div>

            <div class="p-4 flex flex-col flex-grow justify-between">
                <div>
                    <h3 class="font-bold text-base md:text-lg truncate group-hover:text-yellow-500 transition" title="{{ movie.title }}">{{ movie.title }}</h3>
                </div>
                
                <div class="mt-3 pt-3 border-t border-gray-700 text-sm text-gray-400 flex flex-col gap-1">
                    <span class="flex items-center justify-between">
                        <span>ผู้รีวิว:</span>
                        <span class="text-gray-200">{{ movie.v }} คน</span> </span>
                    <span class="flex items-center justify-between">
                        <span>ความเข้มข้น:</span>
                        <span class="text-blue-400">{{ movie.R|floatformat:1 }}/5</span> 
                    </span>
                </div>
            </div>
        </a>
        {% empty %}
            <div class="col-span-full text-center py-16 bg-gray-800 rounded-xl border-2 border-dashed border-gray-700 mx-4">
                <p class="text-xl md:text-2xl text-gray-400 mb-4">ยังไม่มีหนังเรื่องไหนที่ผ่านเกณฑ์ "{{ mood.name }}"</p>
                
                <p class="text-sm text-gray-500 mb-4">
                    หมายเหตุ: ระบบจะแสดงเฉพาะหนังที่มีผู้รีวิวอารมณ์นี้อย่างน้อย 5 คนขึ้นไป<br>
                    เพื่อความแม่นยำของข้อมูลครับ
                </p>

                <a href="{% url 'search_movies' %}" class="inline-block mt-4 bg-yellow-500 text-gray-900 px-6 py-3 rounded-lg font-bold hover:bg-yellow-400 transition">
                    ช่วยรีวิวเพิ่มหน่อย
                </a>
            </div>
        {% endfor %}
    </div>
</div>
{% endblock %}